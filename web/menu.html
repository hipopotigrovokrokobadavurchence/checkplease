<!DOCTYPE HTML>
<html>
<head>
  <meta charset="UTF-8">

  <link rel="stylesheet" type="text/css" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap.min.css" media="screen" />
  <link rel="stylesheet" type="text/css" href="./style.css">

  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  <script type="text/javascript" src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>

</head>
<body>
  <nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="#">Project name</a>
      </div>
      <div id="navbar" class="collapse navbar-collapse">
        <ul class="nav navbar-nav">
          <!-- <li><a href="#about">About</a></li> -->
        </ul>
      </div><!--/.nav-collapse -->
    </div>
  </nav>

  <br/><br/><br/>

  <div id="errContainer"></div>
  <div class="menu-items row" id="menu_items"></div>

</body>
  <script>
  settings = {url: "", apiMethod:"POST"}

  function getMenuItems(){
    $.ajax({
      url: "http://10.21.2.218:7777/appa/app.pl",
       type: "GET",
       data: '{"method":"get_menu_items", "params":{"placeID":"1"}}',
       success: renderMenuItems,
       error: handleErr
   });
  }

  function handleErr(xhr, reqStatus, reqError){
      console.log(xhr);
      $("#errContainer").html('<div class="alert alert-danger"><a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a><strong>Application Error! Please try again later!  </strong></div>');
  }

  function renderMenuItems(result){
    console.log(result)
    obj = JSON.parse(result);

    $("#request_container").html('');

    for(var i = 0; i < obj.length; i++) {
      var backgroundHex = obj[i].SectionColor || '95a5a6';
      var bottomBorder = (parseInt(backgroundHex, 16) - parseInt('303030', 16)).toString(16);
      var style = ';background:#'+backgroundHex+'; border-bottom-color:#' + bottomBorder+';';

      $("#menu_items").html(
        $("#menu_items").html()
        + '<div class="request blue col-sm-7" id="'+obj[i].ID+'">'

        + '</div>'
      )
    }
  }



  function applyChanges(caller){
    console.log("Caller: ", caller.id);

    $.ajax({
      url: "http://10.21.2.218:7777/appa/app.pl",
      type: "POST",
      data: '{"method":"AckRequest", "params":{"requestID":"' + caller.id + '"}}',
      success: function(result){ $("#" +caller.id).remove()},
      error: handleErr
   });
  }

  window.onload = renderMenuItems;
  window.setInterval(renderMenuItems, 5000);

  renderMenuItems('{"result":[{"price":"1.10","id_hash":"f1e737fa-d3e9-4941-bc7d-77ca5a67662c","name":"aaaa","descr":"aaaaa","id":14,"updated_by":1,"ordering":null,"place_id":1,"place_id__id_hash":"08472c7c-a65b-4697-9c16-b691ec096689","inserted_by":1,"image_url":null,"inserted_at":"2016-05-28 15:49:10.848799","updated_at":"2016-05-28 15:49:10.848799"}]}');
  </script>
</html>

